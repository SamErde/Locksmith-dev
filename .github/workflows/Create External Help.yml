# Create external help ZIP and CAB files for PowerShell.
# Requires Windows to use the makecab command.
---
name: ğŸ“š Create External Help

on:
  pull_request:
  # push:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  package_help:
    # The New-ExternalHelpCab cmdlet uses makecab, which depends on Windows.
    runs-on: windows-latest
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@95d9a5deda9de15063e7595e9719c11c38c90ae2 # v2.13.2
        with:
          egress-policy: audit

      - name: âœ… Checkout Repository
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0
      - name: ğŸ“ Display the Path
        shell: pwsh
        run: echo ${env:PATH}
      - name: ğŸ”¢ Display the Version
        shell: pwsh
        run: $PSVersionTable
      - name: ğŸ“– Create and Package External PowerShell Help
        shell: pwsh
        run: |
          Install-Module -Name PlatyPS -Scope CurrentUser -Force -SkipPublisherCheck
          Import-Module -Name PlatyPS -Force
          #Copy-Item ".\Help\en-US\Locksmith-help.xml" ".\Help\en-US"
          $params = @{
              CabFilesFolder  = ".\en-US"
              LandingPagePath = ".\Docs\Locksmith.md"
              OutputFolder    = ".\en-US"
          }
          New-ExternalHelpCab @params
